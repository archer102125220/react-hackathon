"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.connectCarouselFilmStrip = exports.default = void 0;

var _glamor = require("glamor");

var _reactFilm = require("react-film");

var _classnames = _interopRequireDefault(require("classnames"));

var _react = _interopRequireDefault(require("react"));

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _Localize = require("../Localization/Localize");

var _Avatar = _interopRequireDefault(require("./Avatar"));

var _Bubble = _interopRequireDefault(require("./Bubble"));

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _SendStatus = _interopRequireDefault(require("./SendStatus"));

var _textFormatToContentType = _interopRequireDefault(require("../Utils/textFormatToContentType"));

var _Timestamp = _interopRequireDefault(require("./Timestamp"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

var _Constants$ActivityCl = _botframeworkWebchatCore.Constants.ActivityClientState,
    SENDING = _Constants$ActivityCl.SENDING,
    SEND_FAILED = _Constants$ActivityCl.SEND_FAILED;
var ROOT_CSS = (0, _glamor.css)({
  display: 'flex',
  MsOverflowStyle: 'none',
  overflowX: 'scroll',
  overflowY: 'hidden',
  touchAction: 'manipulation',
  WebkitOverflowScrolling: 'touch',
  '&::-webkit-scrollbar': {
    display: 'none'
  },
  '& > .avatar': {
    flexShrink: 0
  },
  '& > .content': {
    flex: 1,
    '& > .message': {
      display: 'flex',
      '& > .bubble': {
        flexGrow: 1,
        overflow: 'hidden'
      },
      '& > .filler': {
        flexGrow: 10000,
        flexShrink: 1
      }
    },
    '& > ul': {
      display: 'flex',
      listStyleType: 'none',
      margin: 0,
      padding: 0,
      '& > li': {
        flex: 1
      }
    }
  }
});

var connectCarouselFilmStrip = function connectCarouselFilmStrip() {
  for (var _len = arguments.length, selectors = new Array(_len), _key = 0; _key < _len; _key++) {
    selectors[_key] = arguments[_key];
  }

  return _connectToWebChat.default.apply(void 0, [function (_ref, _ref2) {
    var language = _ref.language,
        _ref$styleSet$options = _ref.styleSet.options,
        botAvatarInitials = _ref$styleSet$options.botAvatarInitials,
        userAvatarInitials = _ref$styleSet$options.userAvatarInitials;
    var activity = _ref2.activity;
    return {
      avatarInitials: activity.from && activity.from.role === 'user' ? userAvatarInitials : botAvatarInitials,
      language: language
    };
  }].concat(selectors));
};

exports.connectCarouselFilmStrip = connectCarouselFilmStrip;
var ConnectedCarouselFilmStrip = connectCarouselFilmStrip(function (_ref3) {
  var avatarInitials = _ref3.avatarInitials,
      language = _ref3.language,
      styleSet = _ref3.styleSet;
  return {
    avatarInitials: avatarInitials,
    language: language,
    styleSet: styleSet
  };
})(function (_ref4) {
  var activity = _ref4.activity,
      avatarInitials = _ref4.avatarInitials,
      children = _ref4.children,
      language = _ref4.language,
      className = _ref4.className,
      filmContext = _ref4.filmContext,
      styleSet = _ref4.styleSet,
      timestampClassName = _ref4.timestampClassName;
  var fromUser = activity.from.role === 'user';
  var ariaLabel = (0, _Localize.localize)('Bot said something', language, avatarInitials, activity.text, activity.timestamp);
  var activityDisplayText = activity.channelData && activity.channelData.messageBack && activity.channelData.messageBack.displayText || activity.text;
  return _react.default.createElement("div", {
    className: (0, _classnames.default)(ROOT_CSS + '', styleSet.carouselFilmStrip + '', (className || '') + ''),
    ref: filmContext._setFilmStripRef
  }, _react.default.createElement(_Avatar.default, {
    "aria-hidden": true,
    className: "avatar",
    fromUser: fromUser
  }), _react.default.createElement("div", {
    className: "content"
  }, !!activityDisplayText && _react.default.createElement("div", {
    className: "message"
  }, _react.default.createElement(_Bubble.default, {
    "aria-label": ariaLabel,
    className: "bubble",
    fromUser: fromUser
  }, children({
    activity: activity,
    attachment: {
      contentType: (0, _textFormatToContentType.default)(activity.textFormat),
      content: activityDisplayText
    }
  })), _react.default.createElement("div", {
    className: "filler"
  })), _react.default.createElement("ul", null, activity.attachments.map(function (attachment, index) {
    return _react.default.createElement("li", {
      key: index
    }, _react.default.createElement(_Bubble.default, {
      fromUser: fromUser,
      key: index
    }, children({
      attachment: attachment
    })));
  })), _react.default.createElement("div", {
    "aria-hidden": true,
    className: "row"
  }, activity.channelData && (activity.channelData.state === SENDING || activity.channelData.state === SEND_FAILED) ? _react.default.createElement(_SendStatus.default, {
    activity: activity
  }) : _react.default.createElement(_Timestamp.default, {
    activity: activity,
    className: timestampClassName
  }))));
});

var _default = function _default(props) {
  return _react.default.createElement(_reactFilm.Context.Consumer, null, function (filmContext) {
    return _react.default.createElement(ConnectedCarouselFilmStrip, _extends({
      filmContext: filmContext
    }, props));
  });
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BY3Rpdml0eS9DYXJvdXNlbEZpbG1TdHJpcC5qcyJdLCJuYW1lcyI6WyJDb25zdGFudHMiLCJBY3Rpdml0eUNsaWVudFN0YXRlIiwiU0VORElORyIsIlNFTkRfRkFJTEVEIiwiUk9PVF9DU1MiLCJkaXNwbGF5IiwiTXNPdmVyZmxvd1N0eWxlIiwib3ZlcmZsb3dYIiwib3ZlcmZsb3dZIiwidG91Y2hBY3Rpb24iLCJXZWJraXRPdmVyZmxvd1Njcm9sbGluZyIsImZsZXhTaHJpbmsiLCJmbGV4IiwiZmxleEdyb3ciLCJvdmVyZmxvdyIsImxpc3RTdHlsZVR5cGUiLCJtYXJnaW4iLCJwYWRkaW5nIiwiY29ubmVjdENhcm91c2VsRmlsbVN0cmlwIiwic2VsZWN0b3JzIiwiY29ubmVjdFRvV2ViQ2hhdCIsImxhbmd1YWdlIiwic3R5bGVTZXQiLCJvcHRpb25zIiwiYm90QXZhdGFySW5pdGlhbHMiLCJ1c2VyQXZhdGFySW5pdGlhbHMiLCJhY3Rpdml0eSIsImF2YXRhckluaXRpYWxzIiwiZnJvbSIsInJvbGUiLCJDb25uZWN0ZWRDYXJvdXNlbEZpbG1TdHJpcCIsImNoaWxkcmVuIiwiY2xhc3NOYW1lIiwiZmlsbUNvbnRleHQiLCJ0aW1lc3RhbXBDbGFzc05hbWUiLCJmcm9tVXNlciIsImFyaWFMYWJlbCIsInRleHQiLCJ0aW1lc3RhbXAiLCJhY3Rpdml0eURpc3BsYXlUZXh0IiwiY2hhbm5lbERhdGEiLCJtZXNzYWdlQmFjayIsImRpc3BsYXlUZXh0IiwiY2Fyb3VzZWxGaWxtU3RyaXAiLCJfc2V0RmlsbVN0cmlwUmVmIiwiYXR0YWNobWVudCIsImNvbnRlbnRUeXBlIiwidGV4dEZvcm1hdCIsImNvbnRlbnQiLCJhdHRhY2htZW50cyIsIm1hcCIsImluZGV4Iiwic3RhdGUiLCJwcm9wcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztB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QUFBLFdBQ3ZCO0FBQUksTUFBQSxHQUFHLEVBQUdBO0FBQVYsT0FDRSw2QkFBQyxlQUFEO0FBQ0UsTUFBQSxRQUFRLEVBQUdoQixRQURiO0FBRUUsTUFBQSxHQUFHLEVBQUdnQjtBQUZSLE9BSUlwQixRQUFRLENBQUM7QUFBRWMsTUFBQUEsVUFBVSxFQUFWQTtBQUFGLEtBQUQsQ0FKWixDQURGLENBRHVCO0FBQUEsR0FBekIsQ0FGSixDQXBCRixFQWtDRTtBQUNFLG1CQUFjLElBRGhCO0FBRUUsSUFBQSxTQUFTLEVBQUM7QUFGWixLQUtJbkIsUUFBUSxDQUFDYyxXQUFULEtBRUVkLFFBQVEsQ0FBQ2MsV0FBVCxDQUFxQlksS0FBckIsS0FBK0JsRCxPQUEvQixJQUNHd0IsUUFBUSxDQUFDYyxXQUFULENBQXFCWSxLQUFyQixLQUErQmpELFdBSHBDLENBREQsR0FPQyw2QkFBQyxtQkFBRDtBQUFZLElBQUEsUUFBUSxFQUFHdUI7QUFBdkIsSUFQRCxHQVNDLDZCQUFDLGtCQUFEO0FBQ0UsSUFBQSxRQUFRLEVBQUdBLFFBRGI7QUFFRSxJQUFBLFNBQVMsRUFBR1E7QUFGZCxJQWJKLENBbENGLENBYkYsQ0FERjtBQXNFRCxDQXBHZ0MsQ0FBbkM7O2VBdUdlLGtCQUFBbUIsS0FBSztBQUFBLFNBQ2xCLDZCQUFDLGtCQUFELENBQWEsUUFBYixRQUNJLFVBQUFwQixXQUFXO0FBQUEsV0FDWCw2QkFBQywwQkFBRDtBQUNFLE1BQUEsV0FBVyxFQUFHQTtBQURoQixPQUVPb0IsS0FGUCxFQURXO0FBQUEsR0FEZixDQURrQjtBQUFBLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjc3MgfSBmcm9tICdnbGFtb3InO1xuaW1wb3J0IHsgQ29udGV4dCBhcyBGaWxtQ29udGV4dCB9IGZyb20gJ3JlYWN0LWZpbG0nO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyBDb25zdGFudHMgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1jb3JlJztcblxuaW1wb3J0IHsgbG9jYWxpemUgfSBmcm9tICcuLi9Mb2NhbGl6YXRpb24vTG9jYWxpemUnO1xuaW1wb3J0IEF2YXRhciBmcm9tICcuL0F2YXRhcic7XG5pbXBvcnQgQnViYmxlIGZyb20gJy4vQnViYmxlJztcbmltcG9ydCBjb25uZWN0VG9XZWJDaGF0IGZyb20gJy4uL2Nvbm5lY3RUb1dlYkNoYXQnO1xuaW1wb3J0IFNlbmRTdGF0dXMgZnJvbSAnLi9TZW5kU3RhdHVzJztcbmltcG9ydCB0ZXh0Rm9ybWF0VG9Db250ZW50VHlwZSBmcm9tICcuLi9VdGlscy90ZXh0Rm9ybWF0VG9Db250ZW50VHlwZSc7XG5pbXBvcnQgVGltZXN0YW1wIGZyb20gJy4vVGltZXN0YW1wJztcblxuY29uc3QgeyBBY3Rpdml0eUNsaWVudFN0YXRlOiB7IFNFTkRJTkcsIFNFTkRfRkFJTEVEIH0gfSA9IENvbnN0YW50cztcblxuY29uc3QgUk9PVF9DU1MgPSBjc3Moe1xuICBkaXNwbGF5OiAnZmxleCcsXG4gIE1zT3ZlcmZsb3dTdHlsZTogJ25vbmUnLFxuICBvdmVyZmxvd1g6ICdzY3JvbGwnLFxuICBvdmVyZmxvd1k6ICdoaWRkZW4nLFxuICB0b3VjaEFjdGlvbjogJ21hbmlwdWxhdGlvbicsXG4gIFdlYmtpdE92ZXJmbG93U2Nyb2xsaW5nOiAndG91Y2gnLFxuXG4gICcmOjotd2Via2l0LXNjcm9sbGJhcic6IHtcbiAgICBkaXNwbGF5OiAnbm9uZSdcbiAgfSxcblxuICAnJiA+IC5hdmF0YXInOiB7XG4gICAgZmxleFNocmluazogMFxuICB9LFxuXG4gICcmID4gLmNvbnRlbnQnOiB7XG4gICAgZmxleDogMSxcblxuICAgICcmID4gLm1lc3NhZ2UnOiB7XG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG5cbiAgICAgICcmID4gLmJ1YmJsZSc6IHtcbiAgICAgICAgZmxleEdyb3c6IDEsXG4gICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJ1xuICAgICAgfSxcblxuICAgICAgJyYgPiAuZmlsbGVyJzoge1xuICAgICAgICBmbGV4R3JvdzogMTAwMDAsXG4gICAgICAgIGZsZXhTaHJpbms6IDFcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgJyYgPiB1bCc6IHtcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGxpc3RTdHlsZVR5cGU6ICdub25lJyxcbiAgICAgIG1hcmdpbjogMCxcbiAgICAgIHBhZGRpbmc6IDAsXG5cbiAgICAgICcmID4gbGknOiB7XG4gICAgICAgIGZsZXg6IDFcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5jb25zdCBjb25uZWN0Q2Fyb3VzZWxGaWxtU3RyaXAgPSAoLi4uc2VsZWN0b3JzKSA9PiBjb25uZWN0VG9XZWJDaGF0KFxuICAoe1xuICAgIGxhbmd1YWdlLFxuICAgIHN0eWxlU2V0OiB7XG4gICAgICBvcHRpb25zOiB7XG4gICAgICAgIGJvdEF2YXRhckluaXRpYWxzLFxuICAgICAgICB1c2VyQXZhdGFySW5pdGlhbHNcbiAgICAgIH1cbiAgICB9XG4gIH0sIHsgYWN0aXZpdHkgfSkgPT4gKHtcbiAgICBhdmF0YXJJbml0aWFsczogYWN0aXZpdHkuZnJvbSAmJiBhY3Rpdml0eS5mcm9tLnJvbGUgPT09ICd1c2VyJyA/IHVzZXJBdmF0YXJJbml0aWFscyA6IGJvdEF2YXRhckluaXRpYWxzLFxuICAgIGxhbmd1YWdlXG4gIH0pLFxuICAuLi5zZWxlY3RvcnNcbilcblxuY29uc3QgQ29ubmVjdGVkQ2Fyb3VzZWxGaWxtU3RyaXAgPSBjb25uZWN0Q2Fyb3VzZWxGaWxtU3RyaXAoXG4gICh7XG4gICAgYXZhdGFySW5pdGlhbHMsXG4gICAgbGFuZ3VhZ2UsXG4gICAgc3R5bGVTZXRcbiAgfSkgPT4gKHtcbiAgICBhdmF0YXJJbml0aWFscyxcbiAgICBsYW5ndWFnZSxcbiAgICBzdHlsZVNldFxuICB9KVxuKShcbiAgKHtcbiAgICBhY3Rpdml0eSxcbiAgICBhdmF0YXJJbml0aWFscyxcbiAgICBjaGlsZHJlbixcbiAgICBsYW5ndWFnZSxcbiAgICBjbGFzc05hbWUsXG4gICAgZmlsbUNvbnRleHQsXG4gICAgc3R5bGVTZXQsXG4gICAgdGltZXN0YW1wQ2xhc3NOYW1lXG4gIH0pID0+IHtcbiAgICBjb25zdCBmcm9tVXNlciA9IGFjdGl2aXR5LmZyb20ucm9sZSA9PT0gJ3VzZXInO1xuICAgIGNvbnN0IGFyaWFMYWJlbCA9IGxvY2FsaXplKCdCb3Qgc2FpZCBzb21ldGhpbmcnLCBsYW5ndWFnZSwgYXZhdGFySW5pdGlhbHMsIGFjdGl2aXR5LnRleHQsIGFjdGl2aXR5LnRpbWVzdGFtcClcbiAgICBjb25zdCBhY3Rpdml0eURpc3BsYXlUZXh0ID1cbiAgICAgIChcbiAgICAgICAgYWN0aXZpdHkuY2hhbm5lbERhdGFcbiAgICAgICAgJiYgYWN0aXZpdHkuY2hhbm5lbERhdGEubWVzc2FnZUJhY2tcbiAgICAgICAgJiYgYWN0aXZpdHkuY2hhbm5lbERhdGEubWVzc2FnZUJhY2suZGlzcGxheVRleHRcbiAgICAgICkgfHwgYWN0aXZpdHkudGV4dDtcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzTmFtZT17IGNsYXNzTmFtZXMoXG4gICAgICAgICAgUk9PVF9DU1MgKyAnJyxcbiAgICAgICAgICBzdHlsZVNldC5jYXJvdXNlbEZpbG1TdHJpcCArICcnLFxuICAgICAgICAgIChjbGFzc05hbWUgfHwgJycpICsgJydcbiAgICAgICAgKSB9XG4gICAgICAgIHJlZj17IGZpbG1Db250ZXh0Ll9zZXRGaWxtU3RyaXBSZWYgfVxuICAgICAgPlxuICAgICAgICA8QXZhdGFyXG4gICAgICAgICAgYXJpYS1oaWRkZW49eyB0cnVlIH1cbiAgICAgICAgICBjbGFzc05hbWU9XCJhdmF0YXJcIlxuICAgICAgICAgIGZyb21Vc2VyPXsgZnJvbVVzZXIgfVxuICAgICAgICAvPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImNvbnRlbnRcIj5cbiAgICAgICAgICB7XG4gICAgICAgICAgICAhIWFjdGl2aXR5RGlzcGxheVRleHQgJiZcbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtZXNzYWdlXCI+XG4gICAgICAgICAgICAgICAgPEJ1YmJsZVxuICAgICAgICAgICAgICAgICAgYXJpYS1sYWJlbD17IGFyaWFMYWJlbCB9XG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJidWJibGVcIlxuICAgICAgICAgICAgICAgICAgZnJvbVVzZXI9eyBmcm9tVXNlciB9XG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgeyBjaGlsZHJlbih7XG4gICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LFxuICAgICAgICAgICAgICAgICAgICBhdHRhY2htZW50OiB7XG4gICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IHRleHRGb3JtYXRUb0NvbnRlbnRUeXBlKGFjdGl2aXR5LnRleHRGb3JtYXQpLFxuICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGFjdGl2aXR5RGlzcGxheVRleHRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSkgfVxuICAgICAgICAgICAgICAgIDwvQnViYmxlPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmlsbGVyXCIgLz5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgfVxuICAgICAgICAgIDx1bD5cbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgYWN0aXZpdHkuYXR0YWNobWVudHMubWFwKChhdHRhY2htZW50LCBpbmRleCkgPT5cbiAgICAgICAgICAgICAgICA8bGkga2V5PXsgaW5kZXggfT5cbiAgICAgICAgICAgICAgICAgIDxCdWJibGVcbiAgICAgICAgICAgICAgICAgICAgZnJvbVVzZXI9eyBmcm9tVXNlciB9XG4gICAgICAgICAgICAgICAgICAgIGtleT17IGluZGV4IH1cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgeyBjaGlsZHJlbih7IGF0dGFjaG1lbnQgfSkgfVxuICAgICAgICAgICAgICAgICAgPC9CdWJibGU+XG4gICAgICAgICAgICAgICAgPC9saT5cbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIDwvdWw+XG4gICAgICAgICAgPGRpdlxuICAgICAgICAgICAgYXJpYS1oaWRkZW49eyB0cnVlIH1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cInJvd1wiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgeyhcbiAgICAgICAgICAgICAgYWN0aXZpdHkuY2hhbm5lbERhdGFcbiAgICAgICAgICAgICAgJiYgKFxuICAgICAgICAgICAgICAgIGFjdGl2aXR5LmNoYW5uZWxEYXRhLnN0YXRlID09PSBTRU5ESU5HXG4gICAgICAgICAgICAgICAgfHwgYWN0aXZpdHkuY2hhbm5lbERhdGEuc3RhdGUgPT09IFNFTkRfRkFJTEVEXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkgP1xuICAgICAgICAgICAgICA8U2VuZFN0YXR1cyBhY3Rpdml0eT17IGFjdGl2aXR5IH0gLz5cbiAgICAgICAgICAgIDpcbiAgICAgICAgICAgICAgPFRpbWVzdGFtcFxuICAgICAgICAgICAgICAgIGFjdGl2aXR5PXsgYWN0aXZpdHkgfVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17IHRpbWVzdGFtcENsYXNzTmFtZSB9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuKVxuXG5leHBvcnQgZGVmYXVsdCBwcm9wcyA9PlxuICA8RmlsbUNvbnRleHQuQ29uc3VtZXI+XG4gICAgeyBmaWxtQ29udGV4dCA9PlxuICAgICAgPENvbm5lY3RlZENhcm91c2VsRmlsbVN0cmlwXG4gICAgICAgIGZpbG1Db250ZXh0PXsgZmlsbUNvbnRleHQgfVxuICAgICAgICB7IC4uLnByb3BzIH1cbiAgICAgIC8+XG4gICAgfVxuICA8L0ZpbG1Db250ZXh0LkNvbnN1bWVyPlxuXG5leHBvcnQgeyBjb25uZWN0Q2Fyb3VzZWxGaWxtU3RyaXAgfVxuIl19