"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _glamor = require("glamor");

var _classnames = _interopRequireDefault(require("classnames"));

var _react = _interopRequireDefault(require("react"));

var _BasicSendBox = _interopRequireDefault(require("./BasicSendBox"));

var _BasicTranscript = _interopRequireDefault(require("./BasicTranscript"));

var _Composer = _interopRequireDefault(require("./Composer"));

var _concatMiddleware = _interopRequireDefault(require("./Middleware/concatMiddleware"));

var _createCoreMiddleware = _interopRequireDefault(require("./Middleware/Activity/createCoreMiddleware"));

var _createCoreMiddleware2 = _interopRequireDefault(require("./Middleware/Attachment/createCoreMiddleware"));

var _ErrorBox = _interopRequireDefault(require("./ErrorBox"));

var _TypeFocusSink = _interopRequireDefault(require("./Utils/TypeFocusSink"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

var ROOT_CSS = (0, _glamor.css)({
  display: 'flex',
  flexDirection: 'column'
});
var TRANSCRIPT_CSS = (0, _glamor.css)({
  flex: 1
});
var SEND_BOX_CSS = (0, _glamor.css)({
  flexShrink: 0
});

var _default =
/*#__PURE__*/
function (_React$Component) {
  _inherits(_default, _React$Component);

  function _default(props) {
    var _this;

    _classCallCheck(this, _default);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(_default).call(this, props));
    _this.sendBoxRef = _react.default.createRef();
    _this.state = {
      activityRenderer: _this.createActivityRenderer(props.activityMiddleware),
      attachmentRenderer: _this.createAttachmentRenderer(props.attachmentMiddleware)
    };
    return _this;
  } // TODO: [P2] Move to React 16 APIs


  _createClass(_default, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(_ref) {
      var _this2 = this;

      var activityMiddleware = _ref.activityMiddleware,
          attachmentMiddleware = _ref.attachmentMiddleware;

      if (this.props.activityMiddleware !== activityMiddleware || this.props.attachmentMiddleware !== attachmentMiddleware) {
        this.setState(function () {
          return {
            activityRenderer: _this2.createActivityRenderer(activityMiddleware),
            attachmentRenderer: _this2.createAttachmentRenderer(attachmentMiddleware)
          };
        });
      }
    }
  }, {
    key: "createActivityRenderer",
    value: function createActivityRenderer(additionalMiddleware) {
      var activityMiddleware = (0, _concatMiddleware.default)(additionalMiddleware, (0, _createCoreMiddleware.default)())({});
      return function () {
        try {
          return activityMiddleware(function (_ref2) {
            var activity = _ref2.activity;
            return function () {
              return _react.default.createElement(_ErrorBox.default, {
                message: "No renderer for this activity"
              }, _react.default.createElement("pre", null, JSON.stringify(activity, null, 2)));
            };
          }).apply(void 0, arguments);
        } catch (err) {
          return function () {
            return _react.default.createElement(_ErrorBox.default, {
              message: "Failed to render activity"
            }, _react.default.createElement("pre", null, JSON.stringify(err, null, 2)));
          };
        }
      };
    }
  }, {
    key: "createAttachmentRenderer",
    value: function createAttachmentRenderer(additionalMiddleware) {
      var attachmentMiddleware = (0, _concatMiddleware.default)(additionalMiddleware, (0, _createCoreMiddleware2.default)())({});
      return function () {
        try {
          return attachmentMiddleware(function (_ref3) {
            var attachment = _ref3.attachment;
            return _react.default.createElement(_ErrorBox.default, {
              message: "No renderer for this attachment"
            }, _react.default.createElement("pre", null, JSON.stringify(attachment, null, 2)));
          }).apply(void 0, arguments);
        } catch (err) {
          return _react.default.createElement(_ErrorBox.default, {
            message: "Failed to render attachment"
          }, _react.default.createElement("pre", null, JSON.stringify(err, null, 2)));
        }
      };
    }
  }, {
    key: "render",
    value: function render() {
      var _this3 = this;

      var props = this.props,
          state = this.state; // TODO: [P2] Implement "scrollToBottom" feature

      return _react.default.createElement(_Composer.default, _extends({
        activityRenderer: state.activityRenderer,
        attachmentRenderer: state.attachmentRenderer,
        sendBoxRef: this.sendBoxRef
      }, props), function (_ref4) {
        var styleSet = _ref4.styleSet;
        return _react.default.createElement(_TypeFocusSink.default, {
          className: (0, _classnames.default)(ROOT_CSS + '', styleSet.root + '', (props.className || '') + ''),
          role: "complementary",
          sendFocusRef: _this3.sendBoxRef
        }, _react.default.createElement(_BasicTranscript.default, {
          className: TRANSCRIPT_CSS + ''
        }), !styleSet.options.hideSendBox && _react.default.createElement(_BasicSendBox.default, {
          className: SEND_BOX_CSS
        }));
      });
    }
  }]);

  return _default;
}(_react.default.Component);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9CYXNpY1dlYkNoYXQuanMiXSwibmFtZXMiOlsiUk9PVF9DU1MiLCJkaXNwbGF5IiwiZmxleERpcmVjdGlvbiIsIlRSQU5TQ1JJUFRfQ1NTIiwiZmxleCIsIlNFTkRfQk9YX0NTUyIsImZsZXhTaHJpbmsiLCJwcm9wcyIsInNlbmRCb3hSZWYiLCJSZWFjdCIsImNyZWF0ZVJlZiIsInN0YXRlIiwiYWN0aXZpdHlSZW5kZXJlciIsImNyZWF0ZUFjdGl2aXR5UmVuZGVyZXIiLCJhY3Rpdml0eU1pZGRsZXdhcmUiLCJhdHRhY2htZW50UmVuZGVyZXIiLCJjcmVhdGVBdHRhY2htZW50UmVuZGVyZXIiLCJhdHRhY2htZW50TWlkZGxld2FyZSIsInNldFN0YXRlIiwiYWRkaXRpb25hbE1pZGRsZXdhcmUiLCJhY3Rpdml0eSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnIiLCJhdHRhY2htZW50Iiwic3R5bGVTZXQiLCJyb290IiwiY2xhc3NOYW1lIiwib3B0aW9ucyIsImhpZGVTZW5kQm94IiwiQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLFFBQVEsR0FBRyxpQkFBSTtBQUNuQkMsRUFBQUEsT0FBTyxFQUFFLE1BRFU7QUFFbkJDLEVBQUFBLGFBQWEsRUFBRTtBQUZJLENBQUosQ0FBakI7QUFLQSxJQUFNQyxjQUFjLEdBQUcsaUJBQUk7QUFDekJDLEVBQUFBLElBQUksRUFBRTtBQURtQixDQUFKLENBQXZCO0FBSUEsSUFBTUMsWUFBWSxHQUFHLGlCQUFJO0FBQ3ZCQyxFQUFBQSxVQUFVLEVBQUU7QUFEVyxDQUFKLENBQXJCOzs7Ozs7O0FBS0Usb0JBQVlDLEtBQVosRUFBbUI7QUFBQTs7QUFBQTs7QUFDakIsa0ZBQU1BLEtBQU47QUFFQSxVQUFLQyxVQUFMLEdBQWtCQyxl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LFFBQUEsVUFBVSxFQUFHLEtBQUtQO0FBSHBCLFNBSU9ELEtBSlAsR0FNSTtBQUFBLFlBQUdrQixRQUFILFNBQUdBLFFBQUg7QUFBQSxlQUNBLDZCQUFDLHNCQUFEO0FBQ0UsVUFBQSxTQUFTLEVBQUcseUJBQVd6QixRQUFRLEdBQUcsRUFBdEIsRUFBMEJ5QixRQUFRLENBQUNDLElBQVQsR0FBZ0IsRUFBMUMsRUFBOEMsQ0FBQ25CLEtBQUssQ0FBQ29CLFNBQU4sSUFBbUIsRUFBcEIsSUFBMEIsRUFBeEUsQ0FEZDtBQUVFLFVBQUEsSUFBSSxFQUFDLGVBRlA7QUFHRSxVQUFBLFlBQVksRUFBRyxNQUFJLENBQUNuQjtBQUh0QixXQUtFLDZCQUFDLHdCQUFEO0FBQWlCLFVBQUEsU0FBUyxFQUFHTCxjQUFjLEdBQUc7QUFBOUMsVUFMRixFQU1JLENBQUNzQixRQUFRLENBQUNHLE9BQVQsQ0FBaUJDLFdBQWxCLElBQ0EsNkJBQUMscUJBQUQ7QUFBYyxVQUFBLFNBQVMsRUFBR3hCO0FBQTFCLFVBUEosQ0FEQTtBQUFBLE9BTkosQ0FERjtBQXFCRDs7OztFQW5HMEJJLGVBQU1xQixTIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3NzIH0gZnJvbSAnZ2xhbW9yJztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IEJhc2ljU2VuZEJveCBmcm9tICcuL0Jhc2ljU2VuZEJveCc7XG5pbXBvcnQgQmFzaWNUcmFuc2NyaXB0IGZyb20gJy4vQmFzaWNUcmFuc2NyaXB0JztcbmltcG9ydCBDb21wb3NlciBmcm9tICcuL0NvbXBvc2VyJztcbmltcG9ydCBjb25jYXRNaWRkbGV3YXJlIGZyb20gJy4vTWlkZGxld2FyZS9jb25jYXRNaWRkbGV3YXJlJztcbmltcG9ydCBjcmVhdGVDb3JlQWN0aXZpdHlNaWRkbGV3YXJlIGZyb20gJy4vTWlkZGxld2FyZS9BY3Rpdml0eS9jcmVhdGVDb3JlTWlkZGxld2FyZSc7XG5pbXBvcnQgY3JlYXRlQ29yZUF0dGFjaG1lbnRNaWRkbGV3YXJlIGZyb20gJy4vTWlkZGxld2FyZS9BdHRhY2htZW50L2NyZWF0ZUNvcmVNaWRkbGV3YXJlJztcbmltcG9ydCBFcnJvckJveCBmcm9tICcuL0Vycm9yQm94JztcbmltcG9ydCBUeXBlRm9jdXNTaW5rQm94IGZyb20gJy4vVXRpbHMvVHlwZUZvY3VzU2luayc7XG5cbmNvbnN0IFJPT1RfQ1NTID0gY3NzKHtcbiAgZGlzcGxheTogJ2ZsZXgnLFxuICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJ1xufSk7XG5cbmNvbnN0IFRSQU5TQ1JJUFRfQ1NTID0gY3NzKHtcbiAgZmxleDogMVxufSk7XG5cbmNvbnN0IFNFTkRfQk9YX0NTUyA9IGNzcyh7XG4gIGZsZXhTaHJpbms6IDBcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5zZW5kQm94UmVmID0gUmVhY3QuY3JlYXRlUmVmKCk7XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgYWN0aXZpdHlSZW5kZXJlcjogdGhpcy5jcmVhdGVBY3Rpdml0eVJlbmRlcmVyKHByb3BzLmFjdGl2aXR5TWlkZGxld2FyZSksXG4gICAgICBhdHRhY2htZW50UmVuZGVyZXI6IHRoaXMuY3JlYXRlQXR0YWNobWVudFJlbmRlcmVyKHByb3BzLmF0dGFjaG1lbnRNaWRkbGV3YXJlKVxuICAgIH07XG4gIH1cblxuICAvLyBUT0RPOiBbUDJdIE1vdmUgdG8gUmVhY3QgMTYgQVBJc1xuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKHsgYWN0aXZpdHlNaWRkbGV3YXJlLCBhdHRhY2htZW50TWlkZGxld2FyZSB9KSB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5wcm9wcy5hY3Rpdml0eU1pZGRsZXdhcmUgIT09IGFjdGl2aXR5TWlkZGxld2FyZVxuICAgICAgfHwgdGhpcy5wcm9wcy5hdHRhY2htZW50TWlkZGxld2FyZSAhPT0gYXR0YWNobWVudE1pZGRsZXdhcmVcbiAgICApIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoKCkgPT4gKHtcbiAgICAgICAgYWN0aXZpdHlSZW5kZXJlcjogdGhpcy5jcmVhdGVBY3Rpdml0eVJlbmRlcmVyKGFjdGl2aXR5TWlkZGxld2FyZSksXG4gICAgICAgIGF0dGFjaG1lbnRSZW5kZXJlcjogdGhpcy5jcmVhdGVBdHRhY2htZW50UmVuZGVyZXIoYXR0YWNobWVudE1pZGRsZXdhcmUpXG4gICAgICB9KSk7XG4gICAgfVxuICB9XG5cbiAgY3JlYXRlQWN0aXZpdHlSZW5kZXJlcihhZGRpdGlvbmFsTWlkZGxld2FyZSkge1xuICAgIGNvbnN0IGFjdGl2aXR5TWlkZGxld2FyZSA9IGNvbmNhdE1pZGRsZXdhcmUoXG4gICAgICBhZGRpdGlvbmFsTWlkZGxld2FyZSxcbiAgICAgIGNyZWF0ZUNvcmVBY3Rpdml0eU1pZGRsZXdhcmUoKVxuICAgICkoe30pO1xuXG4gICAgcmV0dXJuICguLi5hcmdzKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gYWN0aXZpdHlNaWRkbGV3YXJlKFxuICAgICAgICAgICh7IGFjdGl2aXR5IH0pID0+ICgpID0+XG4gICAgICAgICAgICA8RXJyb3JCb3ggbWVzc2FnZT1cIk5vIHJlbmRlcmVyIGZvciB0aGlzIGFjdGl2aXR5XCI+XG4gICAgICAgICAgICAgIDxwcmU+eyBKU09OLnN0cmluZ2lmeShhY3Rpdml0eSwgbnVsbCwgMikgfTwvcHJlPlxuICAgICAgICAgICAgPC9FcnJvckJveD5cbiAgICAgICAgKSguLi5hcmdzKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICByZXR1cm4gKCkgPT4gKFxuICAgICAgICAgIDxFcnJvckJveCBtZXNzYWdlPVwiRmFpbGVkIHRvIHJlbmRlciBhY3Rpdml0eVwiPlxuICAgICAgICAgICAgPHByZT57IEpTT04uc3RyaW5naWZ5KGVyciwgbnVsbCwgMikgfTwvcHJlPlxuICAgICAgICAgIDwvRXJyb3JCb3g+XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGNyZWF0ZUF0dGFjaG1lbnRSZW5kZXJlcihhZGRpdGlvbmFsTWlkZGxld2FyZSkge1xuICAgIGNvbnN0IGF0dGFjaG1lbnRNaWRkbGV3YXJlID0gY29uY2F0TWlkZGxld2FyZShcbiAgICAgIGFkZGl0aW9uYWxNaWRkbGV3YXJlLFxuICAgICAgY3JlYXRlQ29yZUF0dGFjaG1lbnRNaWRkbGV3YXJlKClcbiAgICApKHt9KTtcblxuICAgIHJldHVybiAoLi4uYXJncykgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF0dGFjaG1lbnRNaWRkbGV3YXJlKFxuICAgICAgICAgICh7IGF0dGFjaG1lbnQgfSkgPT5cbiAgICAgICAgICAgIDxFcnJvckJveCBtZXNzYWdlPVwiTm8gcmVuZGVyZXIgZm9yIHRoaXMgYXR0YWNobWVudFwiPlxuICAgICAgICAgICAgICA8cHJlPnsgSlNPTi5zdHJpbmdpZnkoYXR0YWNobWVudCwgbnVsbCwgMikgfTwvcHJlPlxuICAgICAgICAgICAgPC9FcnJvckJveD5cbiAgICAgICAgKSguLi5hcmdzKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxFcnJvckJveCBtZXNzYWdlPVwiRmFpbGVkIHRvIHJlbmRlciBhdHRhY2htZW50XCI+XG4gICAgICAgICAgICA8cHJlPnsgSlNPTi5zdHJpbmdpZnkoZXJyLCBudWxsLCAyKSB9PC9wcmU+XG4gICAgICAgICAgPC9FcnJvckJveD5cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBwcm9wcywgc3RhdGUgfSA9IHRoaXM7XG5cbiAgICAvLyBUT0RPOiBbUDJdIEltcGxlbWVudCBcInNjcm9sbFRvQm90dG9tXCIgZmVhdHVyZVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxDb21wb3NlclxuICAgICAgICBhY3Rpdml0eVJlbmRlcmVyPXsgc3RhdGUuYWN0aXZpdHlSZW5kZXJlciB9XG4gICAgICAgIGF0dGFjaG1lbnRSZW5kZXJlcj17IHN0YXRlLmF0dGFjaG1lbnRSZW5kZXJlciB9XG4gICAgICAgIHNlbmRCb3hSZWY9eyB0aGlzLnNlbmRCb3hSZWYgfVxuICAgICAgICB7IC4uLnByb3BzIH1cbiAgICAgID5cbiAgICAgICAgeyAoeyBzdHlsZVNldCB9KSA9PlxuICAgICAgICAgIDxUeXBlRm9jdXNTaW5rQm94XG4gICAgICAgICAgICBjbGFzc05hbWU9eyBjbGFzc05hbWVzKFJPT1RfQ1NTICsgJycsIHN0eWxlU2V0LnJvb3QgKyAnJywgKHByb3BzLmNsYXNzTmFtZSB8fCAnJykgKyAnJykgfVxuICAgICAgICAgICAgcm9sZT1cImNvbXBsZW1lbnRhcnlcIlxuICAgICAgICAgICAgc2VuZEZvY3VzUmVmPXsgdGhpcy5zZW5kQm94UmVmIH1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8QmFzaWNUcmFuc2NyaXB0IGNsYXNzTmFtZT17IFRSQU5TQ1JJUFRfQ1NTICsgJycgfSAvPlxuICAgICAgICAgICAgeyAhc3R5bGVTZXQub3B0aW9ucy5oaWRlU2VuZEJveCAmJlxuICAgICAgICAgICAgICA8QmFzaWNTZW5kQm94IGNsYXNzTmFtZT17IFNFTkRfQk9YX0NTUyB9IC8+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9UeXBlRm9jdXNTaW5rQm94PlxuICAgICAgICB9XG4gICAgICA8L0NvbXBvc2VyPlxuICAgICk7XG4gIH1cbn1cbiJdfQ==