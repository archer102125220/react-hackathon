"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _reactScrollToBottom = require("react-scroll-to-bottom");

var _reactRedux = require("react-redux");

var _glamor = require("glamor");

var _memoizeOne = _interopRequireDefault(require("memoize-one"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _botframeworkWebchatCore = require("botframework-webchat-core");

var _concatMiddleware = _interopRequireDefault(require("./Middleware/concatMiddleware"));

var _Context = _interopRequireDefault(require("./Context"));

var _createCoreMiddleware = _interopRequireDefault(require("./Middleware/CardAction/createCoreMiddleware"));

var _createStyleSet = _interopRequireDefault(require("./Styles/createStyleSet"));

var _adaptiveCardHostConfig = _interopRequireDefault(require("./Styles/adaptiveCardHostConfig"));

var _Dictation = _interopRequireDefault(require("./Dictation"));

var _mapMap = _interopRequireDefault(require("./Utils/mapMap"));

var _observableToPromise = _interopRequireDefault(require("./Utils/observableToPromise"));

var _shallowEquals = _interopRequireDefault(require("./Utils/shallowEquals"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }

function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }

// Flywheel object
var EMPTY_ARRAY = [];
var DISPATCHERS = {
  markActivity: _botframeworkWebchatCore.markActivity,
  postActivity: _botframeworkWebchatCore.postActivity,
  sendEvent: _botframeworkWebchatCore.sendEvent,
  sendFiles: _botframeworkWebchatCore.sendFiles,
  sendMessage: _botframeworkWebchatCore.sendMessage,
  sendMessageBack: _botframeworkWebchatCore.sendMessageBack,
  sendPostBack: _botframeworkWebchatCore.sendPostBack,
  setDictateInterims: _botframeworkWebchatCore.setDictateInterims,
  setDictateState: _botframeworkWebchatCore.setDictateState,
  setSendBox: _botframeworkWebchatCore.setSendBox,
  setSendTimeout: _botframeworkWebchatCore.setSendTimeout,
  startDictate: _botframeworkWebchatCore.startDictate,
  startSpeakingActivity: _botframeworkWebchatCore.startSpeakingActivity,
  stopDictate: _botframeworkWebchatCore.stopDictate,
  stopSpeakingActivity: _botframeworkWebchatCore.stopSpeakingActivity,
  submitSendBox: _botframeworkWebchatCore.submitSendBox
};

function styleSetToClassNames(styleSet) {
  return (0, _mapMap.default)(styleSet, function (style, key) {
    return key === 'options' ? style : (0, _glamor.css)(style);
  });
}

function createCardActionLogic(_ref) {
  var cardActionMiddleware = _ref.cardActionMiddleware,
      directLine = _ref.directLine,
      dispatch = _ref.dispatch;
  var runMiddleware = (0, _concatMiddleware.default)(cardActionMiddleware, (0, _createCoreMiddleware.default)())({
    dispatch: dispatch
  });
  return {
    onCardAction: function onCardAction(cardAction) {
      return runMiddleware(function (_ref2) {
        var type = _ref2.cardAction.type;
        throw new Error("Web Chat: received unknown card action \"".concat(type, "\""));
      })({
        cardAction: cardAction,
        getSignInUrl: cardAction.type === 'signin' ? function () {
          var value = cardAction.value;

          if (directLine.getSessionId) {
            // TODO: [P3] We should change this one to async/await.
            //       This is the first place in this project to use async.
            //       Thus, we need to add @babel/plugin-transform-runtime and @babel/runtime.
            return (0, _observableToPromise.default)(directLine.getSessionId()).then(function (sessionId) {
              return "".concat(value).concat(encodeURIComponent("&code_challenge=".concat(sessionId)));
            });
          } else {
            return value;
          }
        } : null
      });
    }
  };
}

function createFocusSendBoxLogic(_ref3) {
  var sendBoxRef = _ref3.sendBoxRef;
  return {
    focusSendBox: function focusSendBox() {
      var _ref4 = sendBoxRef || {},
          current = _ref4.current;

      current && current.focus();
    }
  };
}

function createStyleSetLogic(_ref5) {
  var styleOptions = _ref5.styleOptions,
      styleSet = _ref5.styleSet;
  return {
    styleSet: styleSetToClassNames(styleSet || (0, _createStyleSet.default)(styleOptions))
  };
} // TODO: [P3] Take this deprecation code out when releasing on or after 2019 December 11


function patchPropsForAvatarInitials(_ref6) {
  var botAvatarInitials = _ref6.botAvatarInitials,
      userAvatarInitials = _ref6.userAvatarInitials,
      props = _objectWithoutProperties(_ref6, ["botAvatarInitials", "userAvatarInitials"]);

  // This code will take out "botAvatarInitials" and "userAvatarInitials" from props
  var styleOptions = props.styleOptions;

  if (botAvatarInitials) {
    styleOptions = _objectSpread({}, styleOptions, {
      botAvatarInitials: botAvatarInitials
    });
    console.warn('Web Chat: "botAvatarInitials" is deprecated. Please use "styleOptions.botAvatarInitials" instead. "botAvatarInitials" will be removed on or after December 11 2019 .');
  }

  if (userAvatarInitials) {
    styleOptions = _objectSpread({}, styleOptions, {
      userAvatarInitials: userAvatarInitials
    });
    console.warn('Web Chat: "botAvatarInitials" is deprecated. Please use "styleOptions.botAvatarInitials" instead. "botAvatarInitials" will be removed on or after December 11 2019 .');
  }

  return _objectSpread({}, props, {
    styleOptions: styleOptions
  });
}

function createLogic(props) {
  // This is a heavy function, and it is expected to be only called when there is a need to recreate business logic, e.g.
  // - User ID changed, causing all send* functions to be updated
  // - send
  // TODO: [P4] We should break this into smaller pieces using memoization function, so we don't recreate styleSet if userID is changed
  // TODO: [P3] We should think about if we allow the user to change onSendBoxValueChanged/sendBoxValue, e.g.
  // 1. Turns text into UPPERCASE
  // 2. Filter out profanity
  // TODO: [P4] Revisit all members of context
  props = patchPropsForAvatarInitials(props);
  return _objectSpread({}, props, createCardActionLogic(props), createFocusSendBoxLogic(props), createStyleSetLogic(props));
}

var Composer =
/*#__PURE__*/
function (_React$Component) {
  _inherits(Composer, _React$Component);

  function Composer(props) {
    var _this;

    _classCallCheck(this, Composer);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(Composer).call(this, props));
    _this.createContextFromProps = (0, _memoizeOne.default)(createLogic, _shallowEquals.default);
    _this.createWebSpeechPonyfill = (0, _memoizeOne.default)(function (webSpeechPonyfillFactory, referenceGrammarID) {
      return webSpeechPonyfillFactory && webSpeechPonyfillFactory({
        referenceGrammarID: referenceGrammarID
      });
    });
    _this.mergeContext = (0, _memoizeOne.default)(function () {
      for (var _len = arguments.length, contexts = new Array(_len), _key = 0; _key < _len; _key++) {
        contexts[_key] = arguments[_key];
      }

      return Object.assign.apply(Object, [{}].concat(contexts));
    }, _shallowEquals.default);
    _this.state = {
      hoistedDispatchers: (0, _mapMap.default)(DISPATCHERS, function (dispatcher) {
        return function () {
          for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
            args[_key2] = arguments[_key2];
          }

          return _this.props.dispatch(dispatcher.apply(_assertThisInitialized(_assertThisInitialized(_this)), args));
        };
      })
    };
    return _this;
  }

  _createClass(Composer, [{
    key: "componentWillMount",
    value: function componentWillMount() {
      var props = this.props;
      var directLine = props.directLine,
          userID = props.userID,
          username = props.username;
      this.setLanguageFromProps(props);
      this.setSendTimeoutFromProps(props);
      this.setSendTypingIndicatorFromProps(props);
      props.dispatch((0, _botframeworkWebchatCore.connect)({
        directLine: directLine,
        userID: userID,
        username: username
      }));
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      var props = this.props;
      var directLine = props.directLine,
          locale = props.locale,
          sendTimeout = props.sendTimeout,
          sendTyping = props.sendTyping,
          sendTypingIndicator = props.sendTypingIndicator,
          userID = props.userID,
          username = props.username;

      if (prevProps.locale !== locale) {
        this.setLanguageFromProps(props);
      }

      if (prevProps.sendTimeout !== sendTimeout) {
        this.setSendTimeoutFromProps(props);
      }

      if (!prevProps.sendTypingIndicator !== !sendTypingIndicator // TODO: [P3] Take this deprecation code out when releasing on or after January 13 2020
      || !prevProps.sendTyping !== !sendTyping) {
        this.setSendTypingIndicatorFromProps(props);
      }

      if (prevProps.directLine !== directLine || prevProps.userID !== userID || prevProps.username !== username) {
        // TODO: [P3] disconnect() is an async call (pending -> fulfilled), we need to wait, or change it to reconnect()
        props.dispatch((0, _botframeworkWebchatCore.disconnect)());
        props.dispatch((0, _botframeworkWebchatCore.connect)({
          directLine: directLine,
          userID: userID,
          username: username
        }));
      }
    }
  }, {
    key: "setLanguageFromProps",
    value: function setLanguageFromProps(props) {
      props.dispatch((0, _botframeworkWebchatCore.setLanguage)(props.locale || window.navigator.language || 'en-US'));
    }
  }, {
    key: "setSendTimeoutFromProps",
    value: function setSendTimeoutFromProps(props) {
      props.dispatch((0, _botframeworkWebchatCore.setSendTimeout)(props.sendTimeout || 20000));
    }
  }, {
    key: "setSendTypingIndicatorFromProps",
    value: function setSendTypingIndicatorFromProps(props) {
      if (typeof props.sendTyping === 'undefined') {
        props.dispatch((0, _botframeworkWebchatCore.setSendTypingIndicator)(!!props.sendTypingIndicator));
      } else {
        // TODO: [P3] Take this deprecation code out when releasing on or after January 13 2020
        console.warn('Web Chat: "sendTyping" has been renamed to "sendTypingIndicator". Please use "sendTypingIndicator" instead. This deprecation migration will be removed on or after January 13 2020.');
        props.dispatch((0, _botframeworkWebchatCore.setSendTypingIndicator)(!!props.sendTyping));
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props = this.props,
          activityRenderer = _this$props.activityRenderer,
          adaptiveCardHostConfig = _this$props.adaptiveCardHostConfig,
          attachmentRenderer = _this$props.attachmentRenderer,
          children = _this$props.children,
          disabled = _this$props.disabled,
          grammars = _this$props.grammars,
          groupTimestamp = _this$props.groupTimestamp,
          referenceGrammarID = _this$props.referenceGrammarID,
          renderMarkdown = _this$props.renderMarkdown,
          scrollToEnd = _this$props.scrollToEnd,
          store = _this$props.store,
          userID = _this$props.userID,
          username = _this$props.username,
          webSpeechPonyfillFactory = _this$props.webSpeechPonyfillFactory,
          propsForLogic = _objectWithoutProperties(_this$props, ["activityRenderer", "adaptiveCardHostConfig", "attachmentRenderer", "children", "disabled", "grammars", "groupTimestamp", "referenceGrammarID", "renderMarkdown", "scrollToEnd", "store", "userID", "username", "webSpeechPonyfillFactory"]),
          state = this.state;

      var contextFromProps = this.createContextFromProps(propsForLogic);
      var context = this.mergeContext(contextFromProps, state.hoistedDispatchers, // TODO: [P4] Should we normalize empties here? Or should we let it thru?
      //       If we let it thru, the code below become simplified and the user can plug in whatever they want for context, via Composer.props
      {
        activityRenderer: activityRenderer,
        adaptiveCardHostConfig: adaptiveCardHostConfig || (0, _adaptiveCardHostConfig.default)(this.props.styleOptions),
        attachmentRenderer: attachmentRenderer,
        groupTimestamp: groupTimestamp,
        disabled: disabled,
        grammars: grammars || EMPTY_ARRAY,
        renderMarkdown: renderMarkdown,
        scrollToEnd: scrollToEnd,
        store: store,
        webSpeechPonyfill: this.createWebSpeechPonyfill(webSpeechPonyfillFactory, referenceGrammarID)
      }); // TODO: [P3] Check how many times we do re-render context

      return _react.default.createElement(_Context.default.Provider, {
        value: context
      }, typeof children === 'function' ? children(context) : children, _react.default.createElement(_Dictation.default, null));
    }
  }]);

  return Composer;
}(_react.default.Component);

var ConnectedComposer = (0, _reactRedux.connect)(function (_ref7) {
  var referenceGrammarID = _ref7.referenceGrammarID;
  return {
    referenceGrammarID: referenceGrammarID
  };
})(function (props) {
  return _react.default.createElement(_reactScrollToBottom.Composer, null, _react.default.createElement(_reactScrollToBottom.FunctionContext.Consumer, null, function (_ref8) {
    var scrollToEnd = _ref8.scrollToEnd;
    return _react.default.createElement(Composer, _extends({
      scrollToEnd: scrollToEnd
    }, props));
  }));
}); // We will create a Redux store if it was not passed in

var ConnectedComposerWithStore =
/*#__PURE__*/
function (_React$Component2) {
  _inherits(ConnectedComposerWithStore, _React$Component2);

  function ConnectedComposerWithStore(props) {
    var _this2;

    _classCallCheck(this, ConnectedComposerWithStore);

    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(ConnectedComposerWithStore).call(this, props));
    _this2.createMemoizedStore = (0, _memoizeOne.default)(function () {
      return (0, _botframeworkWebchatCore.createStore)();
    });
    return _this2;
  }

  _createClass(ConnectedComposerWithStore, [{
    key: "render",
    value: function render() {
      var props = this.props;
      return _react.default.createElement(ConnectedComposer, _extends({}, props, {
        store: props.store || this.createMemoizedStore()
      }));
    }
  }]);

  return ConnectedComposerWithStore;
}(_react.default.Component);

var _default = ConnectedComposerWithStore; // TODO: [P3] We should consider moving some props to Redux store
//       Although we use `connectToWebChat` to hide the details of accessor of Redux store,
//       we should clean up the responsibility between Context and Redux store
//       We should decide which data is needed for React but not in other environment such as CLI/VSCode

exports.default = _default;
ConnectedComposerWithStore.propTypes = {
  activityRenderer: _propTypes.default.func,
  adaptiveCardHostConfig: _propTypes.default.any,
  attachmentRenderer: _propTypes.default.func,
  cardActionMiddleware: _propTypes.default.func,
  groupTimestamp: _propTypes.default.oneOfType([_propTypes.default.bool, _propTypes.default.number]),
  disabled: _propTypes.default.bool,
  grammars: _propTypes.default.arrayOf(_propTypes.default.string),
  openUrlPonyfillFactory: _propTypes.default.func,
  referenceGrammarID: _propTypes.default.string,
  renderMarkdown: _propTypes.default.func,
  scrollToBottom: _propTypes.default.func,
  sendTimeout: _propTypes.default.number,
  sendTypingIndicator: _propTypes.default.bool,
  store: _propTypes.default.any,
  userID: _propTypes.default.string,
  username: _propTypes.default.string,
  webSpeechPonyfillFactory: _propTypes.default.func
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Db21wb3Nlci5qcyJdLCJuYW1lcyI6WyJFTVBUWV9BUlJBWSIsIkRJU1BBVENIRVJTIiwibWFya0FjdGl2aXR5IiwicG9zdEFjdGl2aXR5Iiwic2VuZEV2ZW50Iiwic2VuZEZpbGVzIiwic2VuZE1lc3NhZ2UiLCJzZW5kTWVzc2FnZUJhY2siLCJzZW5kUG9zdEJhY2siLCJzZXREaWN0YXRlSW50ZXJpbXMiLCJzZXREaWN0YXRlU3RhdGUiLCJzZXRTZW5kQm94Iiwic2V0U2VuZFRpbWVvdXQiLCJzdGFydERpY3RhdGUiLCJzdGFydFNwZWFraW5nQWN0aXZpdHkiLCJzdG9wRGljdGF0ZSIsInN0b3BTcGVha2luZ0FjdGl2aXR5Iiwic3VibWl0U2VuZEJveCIsInN0eWxlU2V0VG9DbGFzc05hbWVzIiwic3R5bGVTZXQiLCJzdHlsZSIsImtleSIsImNyZWF0ZUNhcmRBY3Rpb25Mb2dpYyIsImNhcmRBY3Rpb25NaWRkbGV3YXJlIiwiZGlyZWN0TGluZSIsImRpc3BhdGNoIiwicnVuTWlkZGxld2FyZSIsIm9uQ2FyZEFjdGlvbiIsImNhcmRBY3Rpb24iLCJ0eXBlIiwiRXJyb3IiLCJnZXRTaWduSW5VcmwiLCJ2YWx1ZSIsImdldFNlc3Npb25JZCIsInRoZW4iLCJzZXNzaW9uSWQiLCJlbmNvZGVVUklDb21wb25lbnQiLCJjcmVhdGVGb2N1c1NlbmRCb3hMb2dpYyIsInNlbmRCb3hSZWYiLCJmb2N1c1NlbmRCb3giLCJjdXJyZW50IiwiZm9jdXMiLCJjcmVhdGVTdHlsZVNldExvZ2ljIiwic3R5bGVPcHRpb25zIiwicGF0Y2hQcm9wc0ZvckF2YXRhckluaXRpYWxzIiwiYm90QXZhdGFySW5pdGlhbHMiLCJ1c2VyQXZhdGFySW5pdGlhbHMiLCJwcm9wcyIsImNvbnNvbGUiLCJ3YXJuIiwiY3JlYXRlTG9naWMiLCJDb21wb3NlciIsImNyZWF0ZUNvbnRleHRGcm9tUHJvcHMiLCJzaGFsbG93RXF1YWxzIiwiY3JlYXRlV2ViU3BlZWNoUG9ueWZpbGwiLCJ3ZWJTcGVlY2hQb255ZmlsbEZhY3RvcnkiLCJyZWZlcmVuY2VHcmFtbWFySUQiLCJtZXJnZUNvbnRleHQiLCJjb250ZXh0cyIsIk9iamVjdCIsImFzc2lnbiIsInN0YXRlIiwiaG9pc3RlZERpc3BhdGNoZXJzIiwiZGlzcGF0Y2hlciIsImFyZ3MiLCJhcHBseSIsInVzZXJJRCIsInVzZXJuYW1lIiwic2V0TGFuZ3VhZ2VGcm9tUHJvcHMiLCJzZXRTZW5kVGltZW91dEZyb21Qcm9wcyIsInNldFNlbmRUeXBpbmdJbmRpY2F0b3JGcm9tUHJvcHMiLCJwcmV2UHJvcHMiLCJsb2NhbGUiLCJzZW5kVGltZW91dCIsInNlbmRUeXBpbmciLCJzZW5kVHlwaW5nSW5kaWNhdG9yIiwid2luZG93IiwibmF2aWdhdG9yIiwibGFuZ3VhZ2UiLCJhY3Rpdml0eVJlbmRlcmVyIiwiYWRhcHRpdmVDYXJkSG9zdENvbmZpZyIsImF0dGFjaG1lbnRSZW5kZXJlciIsImNoaWxkcmVuIiwiZGlzYWJsZWQiLCJncmFtbWFycyIsImdyb3VwVGltZXN0YW1wIiwicmVuZGVyTWFya2Rvd24iLCJzY3JvbGxUb0VuZCIsInN0b3JlIiwicHJvcHNGb3JMb2dpYyIsImNvbnRleHRGcm9tUHJvcHMiLCJjb250ZXh0Iiwid2ViU3BlZWNoUG9ueWZpbGwiLCJSZWFjdCIsIkNvbXBvbmVudCIsIkNvbm5lY3RlZENvbXBvc2VyIiwiQ29ubmVjdGVkQ29tcG9zZXJXaXRoU3RvcmUiLCJjcmVhdGVNZW1vaXplZFN0b3JlIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwiZnVuYyIsImFueSIsIm9uZU9mVHlwZSIsImJvb2wiLCJudW1iZXIiLCJhcnJheU9mIiwic3RyaW5nIiwib3BlblVybFBvbnlmaWxsRmFjdG9yeSIsInNjcm9sbFRvQm90dG9tIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBS0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBd0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztB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b21Db21wb3NlcixcbiAgRnVuY3Rpb25Db250ZXh0IGFzIFNjcm9sbFRvQm90dG9tRnVuY3Rpb25Db250ZXh0XG59IGZyb20gJ3JlYWN0LXNjcm9sbC10by1ib3R0b20nO1xuXG5pbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IHsgY3NzIH0gZnJvbSAnZ2xhbW9yJztcbmltcG9ydCBtZW1vaXplIGZyb20gJ21lbW9pemUtb25lJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQge1xuICBjb25uZWN0IGFzIGNyZWF0ZUNvbm5lY3RBY3Rpb24sXG4gIGNyZWF0ZVN0b3JlLFxuICBkaXNjb25uZWN0LFxuICBtYXJrQWN0aXZpdHksXG4gIHBvc3RBY3Rpdml0eSxcbiAgc2VuZEV2ZW50LFxuICBzZW5kRmlsZXMsXG4gIHNlbmRNZXNzYWdlLFxuICBzZW5kTWVzc2FnZUJhY2ssXG4gIHNlbmRQb3N0QmFjayxcbiAgc2V0RGljdGF0ZUludGVyaW1zLFxuICBzZXREaWN0YXRlU3RhdGUsXG4gIHNldExhbmd1YWdlLFxuICBzZXRTZW5kQm94LFxuICBzZXRTZW5kVGltZW91dCxcbiAgc2V0U2VuZFR5cGluZ0luZGljYXRvcixcbiAgc3RhcnREaWN0YXRlLFxuICBzdGFydFNwZWFraW5nQWN0aXZpdHksXG4gIHN0b3BEaWN0YXRlLFxuICBzdG9wU3BlYWtpbmdBY3Rpdml0eSxcbiAgc3VibWl0U2VuZEJveFxufSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1jb3JlJztcblxuaW1wb3J0IGNvbmNhdE1pZGRsZXdhcmUgZnJvbSAnLi9NaWRkbGV3YXJlL2NvbmNhdE1pZGRsZXdhcmUnO1xuaW1wb3J0IENvbnRleHQgZnJvbSAnLi9Db250ZXh0JztcbmltcG9ydCBjcmVhdGVDb3JlQ2FyZEFjdGlvbk1pZGRsZXdhcmUgZnJvbSAnLi9NaWRkbGV3YXJlL0NhcmRBY3Rpb24vY3JlYXRlQ29yZU1pZGRsZXdhcmUnO1xuaW1wb3J0IGNyZWF0ZVN0eWxlU2V0IGZyb20gJy4vU3R5bGVzL2NyZWF0ZVN0eWxlU2V0JztcbmltcG9ydCBkZWZhdWx0QWRhcHRpdmVDYXJkSG9zdENvbmZpZyBmcm9tICcuL1N0eWxlcy9hZGFwdGl2ZUNhcmRIb3N0Q29uZmlnJztcbmltcG9ydCBEaWN0YXRpb24gZnJvbSAnLi9EaWN0YXRpb24nO1xuaW1wb3J0IG1hcE1hcCBmcm9tICcuL1V0aWxzL21hcE1hcCc7XG5pbXBvcnQgb2JzZXJ2YWJsZVRvUHJvbWlzZSBmcm9tICcuL1V0aWxzL29ic2VydmFibGVUb1Byb21pc2UnO1xuaW1wb3J0IHNoYWxsb3dFcXVhbHMgZnJvbSAnLi9VdGlscy9zaGFsbG93RXF1YWxzJztcblxuLy8gRmx5d2hlZWwgb2JqZWN0XG5jb25zdCBFTVBUWV9BUlJBWSA9IFtdO1xuXG5jb25zdCBESVNQQVRDSEVSUyA9IHtcbiAgbWFya0FjdGl2aXR5LFxuICBwb3N0QWN0aXZpdHksXG4gIHNlbmRFdmVudCxcbiAgc2VuZEZpbGVzLFxuICBzZW5kTWVzc2FnZSxcbiAgc2VuZE1lc3NhZ2VCYWNrLFxuICBzZW5kUG9zdEJhY2ssXG4gIHNldERpY3RhdGVJbnRlcmltcyxcbiAgc2V0RGljdGF0ZVN0YXRlLFxuICBzZXRTZW5kQm94LFxuICBzZXRTZW5kVGltZW91dCxcbiAgc3RhcnREaWN0YXRlLFxuICBzdGFydFNwZWFraW5nQWN0aXZpdHksXG4gIHN0b3BEaWN0YXRlLFxuICBzdG9wU3BlYWtpbmdBY3Rpdml0eSxcbiAgc3VibWl0U2VuZEJveFxufTtcblxuZnVuY3Rpb24gc3R5bGVTZXRUb0NsYXNzTmFtZXMoc3R5bGVTZXQpIHtcbiAgcmV0dXJuIG1hcE1hcChzdHlsZVNldCwgKHN0eWxlLCBrZXkpID0+IGtleSA9PT0gJ29wdGlvbnMnID8gc3R5bGUgOiBjc3Moc3R5bGUpKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQ2FyZEFjdGlvbkxvZ2ljKHsgY2FyZEFjdGlvbk1pZGRsZXdhcmUsIGRpcmVjdExpbmUsIGRpc3BhdGNoIH0pIHtcbiAgY29uc3QgcnVuTWlkZGxld2FyZSA9IGNvbmNhdE1pZGRsZXdhcmUoY2FyZEFjdGlvbk1pZGRsZXdhcmUsIGNyZWF0ZUNvcmVDYXJkQWN0aW9uTWlkZGxld2FyZSgpKSh7IGRpc3BhdGNoIH0pO1xuXG4gIHJldHVybiB7XG4gICAgb25DYXJkQWN0aW9uOiBjYXJkQWN0aW9uID0+IHJ1bk1pZGRsZXdhcmUoKHsgY2FyZEFjdGlvbjogeyB0eXBlIH0gfSkgPT4ge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBXZWIgQ2hhdDogcmVjZWl2ZWQgdW5rbm93biBjYXJkIGFjdGlvbiBcIiR7IHR5cGUgfVwiYCk7XG4gICAgfSkoe1xuICAgICAgY2FyZEFjdGlvbixcbiAgICAgIGdldFNpZ25JblVybDogY2FyZEFjdGlvbi50eXBlID09PSAnc2lnbmluJyA/ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gY2FyZEFjdGlvbjtcblxuICAgICAgICBpZiAoZGlyZWN0TGluZS5nZXRTZXNzaW9uSWQpIHtcbiAgICAgICAgICAvLyBUT0RPOiBbUDNdIFdlIHNob3VsZCBjaGFuZ2UgdGhpcyBvbmUgdG8gYXN5bmMvYXdhaXQuXG4gICAgICAgICAgLy8gICAgICAgVGhpcyBpcyB0aGUgZmlyc3QgcGxhY2UgaW4gdGhpcyBwcm9qZWN0IHRvIHVzZSBhc3luYy5cbiAgICAgICAgICAvLyAgICAgICBUaHVzLCB3ZSBuZWVkIHRvIGFkZCBAYmFiZWwvcGx1Z2luLXRyYW5zZm9ybS1ydW50aW1lIGFuZCBAYmFiZWwvcnVudGltZS5cblxuICAgICAgICAgIHJldHVybiBvYnNlcnZhYmxlVG9Qcm9taXNlKGRpcmVjdExpbmUuZ2V0U2Vzc2lvbklkKCkpLnRoZW4oc2Vzc2lvbklkID0+IGAkeyB2YWx1ZSB9JHsgZW5jb2RlVVJJQ29tcG9uZW50KGAmY29kZV9jaGFsbGVuZ2U9JHsgc2Vzc2lvbklkIH1gKSB9YCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9IDogbnVsbFxuICAgIH0pXG4gIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUZvY3VzU2VuZEJveExvZ2ljKHsgc2VuZEJveFJlZiB9KSB7XG4gIHJldHVybiB7XG4gICAgZm9jdXNTZW5kQm94OiAoKSA9PiB7XG4gICAgICBjb25zdCB7IGN1cnJlbnQgfSA9IHNlbmRCb3hSZWYgfHwge307XG5cbiAgICAgIGN1cnJlbnQgJiYgY3VycmVudC5mb2N1cygpO1xuICAgIH1cbiAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlU3R5bGVTZXRMb2dpYyh7IHN0eWxlT3B0aW9ucywgc3R5bGVTZXQgfSkge1xuICByZXR1cm4ge1xuICAgIHN0eWxlU2V0OiBzdHlsZVNldFRvQ2xhc3NOYW1lcyhzdHlsZVNldCB8fCBjcmVhdGVTdHlsZVNldChzdHlsZU9wdGlvbnMpKVxuICB9O1xufVxuXG4vLyBUT0RPOiBbUDNdIFRha2UgdGhpcyBkZXByZWNhdGlvbiBjb2RlIG91dCB3aGVuIHJlbGVhc2luZyBvbiBvciBhZnRlciAyMDE5IERlY2VtYmVyIDExXG5mdW5jdGlvbiBwYXRjaFByb3BzRm9yQXZhdGFySW5pdGlhbHMoeyBib3RBdmF0YXJJbml0aWFscywgdXNlckF2YXRhckluaXRpYWxzLCAuLi5wcm9wcyB9KSB7XG4gIC8vIFRoaXMgY29kZSB3aWxsIHRha2Ugb3V0IFwiYm90QXZhdGFySW5pdGlhbHNcIiBhbmQgXCJ1c2VyQXZhdGFySW5pdGlhbHNcIiBmcm9tIHByb3BzXG5cbiAgbGV0IHsgc3R5bGVPcHRpb25zIH0gPSBwcm9wcztcblxuICBpZiAoYm90QXZhdGFySW5pdGlhbHMpIHtcbiAgICBzdHlsZU9wdGlvbnMgPSB7IC4uLnN0eWxlT3B0aW9ucywgYm90QXZhdGFySW5pdGlhbHMgfTtcblxuICAgIGNvbnNvbGUud2FybignV2ViIENoYXQ6IFwiYm90QXZhdGFySW5pdGlhbHNcIiBpcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlIFwic3R5bGVPcHRpb25zLmJvdEF2YXRhckluaXRpYWxzXCIgaW5zdGVhZC4gXCJib3RBdmF0YXJJbml0aWFsc1wiIHdpbGwgYmUgcmVtb3ZlZCBvbiBvciBhZnRlciBEZWNlbWJlciAxMSAyMDE5IC4nKTtcbiAgfVxuXG4gIGlmICh1c2VyQXZhdGFySW5pdGlhbHMpIHtcbiAgICBzdHlsZU9wdGlvbnMgPSB7IC4uLnN0eWxlT3B0aW9ucywgdXNlckF2YXRhckluaXRpYWxzIH07XG5cbiAgICBjb25zb2xlLndhcm4oJ1dlYiBDaGF0OiBcImJvdEF2YXRhckluaXRpYWxzXCIgaXMgZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSBcInN0eWxlT3B0aW9ucy5ib3RBdmF0YXJJbml0aWFsc1wiIGluc3RlYWQuIFwiYm90QXZhdGFySW5pdGlhbHNcIiB3aWxsIGJlIHJlbW92ZWQgb24gb3IgYWZ0ZXIgRGVjZW1iZXIgMTEgMjAxOSAuJyk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIC4uLnByb3BzLFxuICAgIHN0eWxlT3B0aW9uc1xuICB9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVMb2dpYyhwcm9wcykge1xuICAvLyBUaGlzIGlzIGEgaGVhdnkgZnVuY3Rpb24sIGFuZCBpdCBpcyBleHBlY3RlZCB0byBiZSBvbmx5IGNhbGxlZCB3aGVuIHRoZXJlIGlzIGEgbmVlZCB0byByZWNyZWF0ZSBidXNpbmVzcyBsb2dpYywgZS5nLlxuICAvLyAtIFVzZXIgSUQgY2hhbmdlZCwgY2F1c2luZyBhbGwgc2VuZCogZnVuY3Rpb25zIHRvIGJlIHVwZGF0ZWRcbiAgLy8gLSBzZW5kXG5cbiAgLy8gVE9ETzogW1A0XSBXZSBzaG91bGQgYnJlYWsgdGhpcyBpbnRvIHNtYWxsZXIgcGllY2VzIHVzaW5nIG1lbW9pemF0aW9uIGZ1bmN0aW9uLCBzbyB3ZSBkb24ndCByZWNyZWF0ZSBzdHlsZVNldCBpZiB1c2VySUQgaXMgY2hhbmdlZFxuXG4gIC8vIFRPRE86IFtQM10gV2Ugc2hvdWxkIHRoaW5rIGFib3V0IGlmIHdlIGFsbG93IHRoZSB1c2VyIHRvIGNoYW5nZSBvblNlbmRCb3hWYWx1ZUNoYW5nZWQvc2VuZEJveFZhbHVlLCBlLmcuXG4gIC8vIDEuIFR1cm5zIHRleHQgaW50byBVUFBFUkNBU0VcbiAgLy8gMi4gRmlsdGVyIG91dCBwcm9mYW5pdHlcblxuICAvLyBUT0RPOiBbUDRdIFJldmlzaXQgYWxsIG1lbWJlcnMgb2YgY29udGV4dFxuICBwcm9wcyA9IHBhdGNoUHJvcHNGb3JBdmF0YXJJbml0aWFscyhwcm9wcyk7XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5wcm9wcyxcbiAgICAuLi5jcmVhdGVDYXJkQWN0aW9uTG9naWMocHJvcHMpLFxuICAgIC4uLmNyZWF0ZUZvY3VzU2VuZEJveExvZ2ljKHByb3BzKSxcbiAgICAuLi5jcmVhdGVTdHlsZVNldExvZ2ljKHByb3BzKVxuICB9O1xufVxuXG5jbGFzcyBDb21wb3NlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5jcmVhdGVDb250ZXh0RnJvbVByb3BzID0gbWVtb2l6ZShcbiAgICAgIGNyZWF0ZUxvZ2ljLFxuICAgICAgc2hhbGxvd0VxdWFsc1xuICAgICk7XG5cbiAgICB0aGlzLmNyZWF0ZVdlYlNwZWVjaFBvbnlmaWxsID0gbWVtb2l6ZSgod2ViU3BlZWNoUG9ueWZpbGxGYWN0b3J5LCByZWZlcmVuY2VHcmFtbWFySUQpID0+IHdlYlNwZWVjaFBvbnlmaWxsRmFjdG9yeSAmJiB3ZWJTcGVlY2hQb255ZmlsbEZhY3RvcnkoeyByZWZlcmVuY2VHcmFtbWFySUQgfSkpO1xuXG4gICAgdGhpcy5tZXJnZUNvbnRleHQgPSBtZW1vaXplKFxuICAgICAgKC4uLmNvbnRleHRzKSA9PiBPYmplY3QuYXNzaWduKHt9LCAuLi5jb250ZXh0cyksXG4gICAgICBzaGFsbG93RXF1YWxzXG4gICAgKTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBob2lzdGVkRGlzcGF0Y2hlcnM6IG1hcE1hcChESVNQQVRDSEVSUywgZGlzcGF0Y2hlciA9PiAoLi4uYXJncykgPT4gdGhpcy5wcm9wcy5kaXNwYXRjaChkaXNwYXRjaGVyLmFwcGx5KHRoaXMsIGFyZ3MpKSlcbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50V2lsbE1vdW50KCkge1xuICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBkaXJlY3RMaW5lLCB1c2VySUQsIHVzZXJuYW1lIH0gPSBwcm9wcztcblxuICAgIHRoaXMuc2V0TGFuZ3VhZ2VGcm9tUHJvcHMocHJvcHMpO1xuICAgIHRoaXMuc2V0U2VuZFRpbWVvdXRGcm9tUHJvcHMocHJvcHMpO1xuICAgIHRoaXMuc2V0U2VuZFR5cGluZ0luZGljYXRvckZyb21Qcm9wcyhwcm9wcyk7XG5cbiAgICBwcm9wcy5kaXNwYXRjaChjcmVhdGVDb25uZWN0QWN0aW9uKHsgZGlyZWN0TGluZSwgdXNlcklELCB1c2VybmFtZSB9KSk7XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgY29uc3QgeyBwcm9wcyB9ID0gdGhpcztcbiAgICBjb25zdCB7IGRpcmVjdExpbmUsIGxvY2FsZSwgc2VuZFRpbWVvdXQsIHNlbmRUeXBpbmcsIHNlbmRUeXBpbmdJbmRpY2F0b3IsIHVzZXJJRCwgdXNlcm5hbWUgfSA9IHByb3BzO1xuXG4gICAgaWYgKHByZXZQcm9wcy5sb2NhbGUgIT09IGxvY2FsZSkge1xuICAgICAgdGhpcy5zZXRMYW5ndWFnZUZyb21Qcm9wcyhwcm9wcyk7XG4gICAgfVxuXG4gICAgaWYgKHByZXZQcm9wcy5zZW5kVGltZW91dCAhPT0gc2VuZFRpbWVvdXQpIHtcbiAgICAgIHRoaXMuc2V0U2VuZFRpbWVvdXRGcm9tUHJvcHMocHJvcHMpO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgICFwcmV2UHJvcHMuc2VuZFR5cGluZ0luZGljYXRvciAhPT0gIXNlbmRUeXBpbmdJbmRpY2F0b3JcblxuICAgICAgLy8gVE9ETzogW1AzXSBUYWtlIHRoaXMgZGVwcmVjYXRpb24gY29kZSBvdXQgd2hlbiByZWxlYXNpbmcgb24gb3IgYWZ0ZXIgSmFudWFyeSAxMyAyMDIwXG4gICAgICB8fCAhcHJldlByb3BzLnNlbmRUeXBpbmcgIT09ICFzZW5kVHlwaW5nXG4gICAgKSB7XG4gICAgICB0aGlzLnNldFNlbmRUeXBpbmdJbmRpY2F0b3JGcm9tUHJvcHMocHJvcHMpO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIHByZXZQcm9wcy5kaXJlY3RMaW5lICE9PSBkaXJlY3RMaW5lXG4gICAgICB8fCBwcmV2UHJvcHMudXNlcklEICE9PSB1c2VySURcbiAgICAgIHx8IHByZXZQcm9wcy51c2VybmFtZSAhPT0gdXNlcm5hbWVcbiAgICApIHtcbiAgICAgIC8vIFRPRE86IFtQM10gZGlzY29ubmVjdCgpIGlzIGFuIGFzeW5jIGNhbGwgKHBlbmRpbmcgLT4gZnVsZmlsbGVkKSwgd2UgbmVlZCB0byB3YWl0LCBvciBjaGFuZ2UgaXQgdG8gcmVjb25uZWN0KClcbiAgICAgIHByb3BzLmRpc3BhdGNoKGRpc2Nvbm5lY3QoKSk7XG4gICAgICBwcm9wcy5kaXNwYXRjaChjcmVhdGVDb25uZWN0QWN0aW9uKHsgZGlyZWN0TGluZSwgdXNlcklELCB1c2VybmFtZSB9KSk7XG4gICAgfVxuICB9XG5cbiAgc2V0TGFuZ3VhZ2VGcm9tUHJvcHMocHJvcHMpIHtcbiAgICBwcm9wcy5kaXNwYXRjaChzZXRMYW5ndWFnZShwcm9wcy5sb2NhbGUgfHwgd2luZG93Lm5hdmlnYXRvci5sYW5ndWFnZSB8fCAnZW4tVVMnKSk7XG4gIH1cblxuICBzZXRTZW5kVGltZW91dEZyb21Qcm9wcyhwcm9wcykge1xuICAgIHByb3BzLmRpc3BhdGNoKHNldFNlbmRUaW1lb3V0KHByb3BzLnNlbmRUaW1lb3V0IHx8IDIwMDAwKSk7XG4gIH1cblxuICBzZXRTZW5kVHlwaW5nSW5kaWNhdG9yRnJvbVByb3BzKHByb3BzKSB7XG4gICAgaWYgKHR5cGVvZiBwcm9wcy5zZW5kVHlwaW5nID09PSAndW5kZWZpbmVkJykge1xuICAgICAgcHJvcHMuZGlzcGF0Y2goc2V0U2VuZFR5cGluZ0luZGljYXRvcighIXByb3BzLnNlbmRUeXBpbmdJbmRpY2F0b3IpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVE9ETzogW1AzXSBUYWtlIHRoaXMgZGVwcmVjYXRpb24gY29kZSBvdXQgd2hlbiByZWxlYXNpbmcgb24gb3IgYWZ0ZXIgSmFudWFyeSAxMyAyMDIwXG4gICAgICBjb25zb2xlLndhcm4oJ1dlYiBDaGF0OiBcInNlbmRUeXBpbmdcIiBoYXMgYmVlbiByZW5hbWVkIHRvIFwic2VuZFR5cGluZ0luZGljYXRvclwiLiBQbGVhc2UgdXNlIFwic2VuZFR5cGluZ0luZGljYXRvclwiIGluc3RlYWQuIFRoaXMgZGVwcmVjYXRpb24gbWlncmF0aW9uIHdpbGwgYmUgcmVtb3ZlZCBvbiBvciBhZnRlciBKYW51YXJ5IDEzIDIwMjAuJyk7XG4gICAgICBwcm9wcy5kaXNwYXRjaChzZXRTZW5kVHlwaW5nSW5kaWNhdG9yKCEhcHJvcHMuc2VuZFR5cGluZykpO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBwcm9wczoge1xuICAgICAgICBhY3Rpdml0eVJlbmRlcmVyLFxuICAgICAgICBhZGFwdGl2ZUNhcmRIb3N0Q29uZmlnLFxuICAgICAgICBhdHRhY2htZW50UmVuZGVyZXIsXG4gICAgICAgIGNoaWxkcmVuLFxuXG4gICAgICAgIC8vIFRPRE86IFtQMl0gQWRkIGRpc2FibGUgaW50ZXJhY3Rpdml0eVxuICAgICAgICBkaXNhYmxlZCxcblxuICAgICAgICBncmFtbWFycyxcbiAgICAgICAgZ3JvdXBUaW1lc3RhbXAsXG4gICAgICAgIHJlZmVyZW5jZUdyYW1tYXJJRCxcbiAgICAgICAgcmVuZGVyTWFya2Rvd24sXG4gICAgICAgIHNjcm9sbFRvRW5kLFxuICAgICAgICBzdG9yZSxcbiAgICAgICAgdXNlcklELFxuICAgICAgICB1c2VybmFtZSxcbiAgICAgICAgd2ViU3BlZWNoUG9ueWZpbGxGYWN0b3J5LFxuICAgICAgICAuLi5wcm9wc0ZvckxvZ2ljXG4gICAgICB9LFxuICAgICAgc3RhdGVcbiAgICB9ID0gdGhpcztcblxuICAgIGNvbnN0IGNvbnRleHRGcm9tUHJvcHMgPSB0aGlzLmNyZWF0ZUNvbnRleHRGcm9tUHJvcHMocHJvcHNGb3JMb2dpYyk7XG5cbiAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5tZXJnZUNvbnRleHQoXG4gICAgICBjb250ZXh0RnJvbVByb3BzLFxuICAgICAgc3RhdGUuaG9pc3RlZERpc3BhdGNoZXJzLFxuXG4gICAgICAvLyBUT0RPOiBbUDRdIFNob3VsZCB3ZSBub3JtYWxpemUgZW1wdGllcyBoZXJlPyBPciBzaG91bGQgd2UgbGV0IGl0IHRocnU/XG4gICAgICAvLyAgICAgICBJZiB3ZSBsZXQgaXQgdGhydSwgdGhlIGNvZGUgYmVsb3cgYmVjb21lIHNpbXBsaWZpZWQgYW5kIHRoZSB1c2VyIGNhbiBwbHVnIGluIHdoYXRldmVyIHRoZXkgd2FudCBmb3IgY29udGV4dCwgdmlhIENvbXBvc2VyLnByb3BzXG4gICAgICB7XG4gICAgICAgIGFjdGl2aXR5UmVuZGVyZXIsXG4gICAgICAgIGFkYXB0aXZlQ2FyZEhvc3RDb25maWc6IGFkYXB0aXZlQ2FyZEhvc3RDb25maWcgfHwgZGVmYXVsdEFkYXB0aXZlQ2FyZEhvc3RDb25maWcodGhpcy5wcm9wcy5zdHlsZU9wdGlvbnMpLFxuICAgICAgICBhdHRhY2htZW50UmVuZGVyZXIsXG5cbiAgICAgICAgZ3JvdXBUaW1lc3RhbXAsXG4gICAgICAgIGRpc2FibGVkLFxuICAgICAgICBncmFtbWFyczogZ3JhbW1hcnMgfHwgRU1QVFlfQVJSQVksXG4gICAgICAgIHJlbmRlck1hcmtkb3duLFxuICAgICAgICBzY3JvbGxUb0VuZCxcbiAgICAgICAgc3RvcmUsXG4gICAgICAgIHdlYlNwZWVjaFBvbnlmaWxsOiB0aGlzLmNyZWF0ZVdlYlNwZWVjaFBvbnlmaWxsKHdlYlNwZWVjaFBvbnlmaWxsRmFjdG9yeSwgcmVmZXJlbmNlR3JhbW1hcklEKVxuICAgICAgfVxuICAgICk7XG5cbiAgICAvLyBUT0RPOiBbUDNdIENoZWNrIGhvdyBtYW55IHRpbWVzIHdlIGRvIHJlLXJlbmRlciBjb250ZXh0XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENvbnRleHQuUHJvdmlkZXIgdmFsdWU9eyBjb250ZXh0IH0+XG4gICAgICAgIHsgdHlwZW9mIGNoaWxkcmVuID09PSAnZnVuY3Rpb24nID8gY2hpbGRyZW4oY29udGV4dCkgOiBjaGlsZHJlbiB9XG4gICAgICAgIDxEaWN0YXRpb24gLz5cbiAgICAgIDwvQ29udGV4dC5Qcm92aWRlcj5cbiAgICApO1xuICB9XG59XG5cbmNvbnN0IENvbm5lY3RlZENvbXBvc2VyID0gY29ubmVjdChcbiAgKHsgcmVmZXJlbmNlR3JhbW1hcklEIH0pID0+ICh7IHJlZmVyZW5jZUdyYW1tYXJJRCB9KVxuKShwcm9wcyA9PlxuICA8U2Nyb2xsVG9Cb3R0b21Db21wb3Nlcj5cbiAgICA8U2Nyb2xsVG9Cb3R0b21GdW5jdGlvbkNvbnRleHQuQ29uc3VtZXI+XG4gICAgICB7ICh7IHNjcm9sbFRvRW5kIH0pID0+XG4gICAgICAgIDxDb21wb3NlclxuICAgICAgICAgIHNjcm9sbFRvRW5kPXsgc2Nyb2xsVG9FbmQgfVxuICAgICAgICAgIHsgLi4ucHJvcHMgfVxuICAgICAgICAvPlxuICAgICAgfVxuICAgIDwvU2Nyb2xsVG9Cb3R0b21GdW5jdGlvbkNvbnRleHQuQ29uc3VtZXI+XG4gIDwvU2Nyb2xsVG9Cb3R0b21Db21wb3Nlcj5cbik7XG5cbi8vIFdlIHdpbGwgY3JlYXRlIGEgUmVkdXggc3RvcmUgaWYgaXQgd2FzIG5vdCBwYXNzZWQgaW5cbmNsYXNzIENvbm5lY3RlZENvbXBvc2VyV2l0aFN0b3JlIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLmNyZWF0ZU1lbW9pemVkU3RvcmUgPSBtZW1vaXplKCgpID0+IGNyZWF0ZVN0b3JlKCkpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPENvbm5lY3RlZENvbXBvc2VyXG4gICAgICAgIHsgLi4ucHJvcHMgfVxuICAgICAgICBzdG9yZT17IHByb3BzLnN0b3JlIHx8IHRoaXMuY3JlYXRlTWVtb2l6ZWRTdG9yZSgpIH1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDb25uZWN0ZWRDb21wb3NlcldpdGhTdG9yZVxuXG4vLyBUT0RPOiBbUDNdIFdlIHNob3VsZCBjb25zaWRlciBtb3Zpbmcgc29tZSBwcm9wcyB0byBSZWR1eCBzdG9yZVxuLy8gICAgICAgQWx0aG91Z2ggd2UgdXNlIGBjb25uZWN0VG9XZWJDaGF0YCB0byBoaWRlIHRoZSBkZXRhaWxzIG9mIGFjY2Vzc29yIG9mIFJlZHV4IHN0b3JlLFxuLy8gICAgICAgd2Ugc2hvdWxkIGNsZWFuIHVwIHRoZSByZXNwb25zaWJpbGl0eSBiZXR3ZWVuIENvbnRleHQgYW5kIFJlZHV4IHN0b3JlXG4vLyAgICAgICBXZSBzaG91bGQgZGVjaWRlIHdoaWNoIGRhdGEgaXMgbmVlZGVkIGZvciBSZWFjdCBidXQgbm90IGluIG90aGVyIGVudmlyb25tZW50IHN1Y2ggYXMgQ0xJL1ZTQ29kZVxuQ29ubmVjdGVkQ29tcG9zZXJXaXRoU3RvcmUucHJvcFR5cGVzID0ge1xuICBhY3Rpdml0eVJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgYWRhcHRpdmVDYXJkSG9zdENvbmZpZzogUHJvcFR5cGVzLmFueSxcbiAgYXR0YWNobWVudFJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgY2FyZEFjdGlvbk1pZGRsZXdhcmU6IFByb3BUeXBlcy5mdW5jLFxuICBncm91cFRpbWVzdGFtcDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmJvb2wsIFByb3BUeXBlcy5udW1iZXJdKSxcbiAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICBncmFtbWFyczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnN0cmluZyksXG4gIG9wZW5VcmxQb255ZmlsbEZhY3Rvcnk6IFByb3BUeXBlcy5mdW5jLFxuICByZWZlcmVuY2VHcmFtbWFySUQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHJlbmRlck1hcmtkb3duOiBQcm9wVHlwZXMuZnVuYyxcbiAgc2Nyb2xsVG9Cb3R0b206IFByb3BUeXBlcy5mdW5jLFxuICBzZW5kVGltZW91dDogUHJvcFR5cGVzLm51bWJlcixcbiAgc2VuZFR5cGluZ0luZGljYXRvcjogUHJvcFR5cGVzLmJvb2wsXG4gIHN0b3JlOiBQcm9wVHlwZXMuYW55LFxuICB1c2VySUQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHVzZXJuYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICB3ZWJTcGVlY2hQb255ZmlsbEZhY3Rvcnk6IFByb3BUeXBlcy5mdW5jXG59O1xuIl19